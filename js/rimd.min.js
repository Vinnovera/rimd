!function(e,t){"use strict";"function"==typeof define&&define.amd?define([],t()):"object"==typeof exports?module.exports=t():e.Rimd=t()}(this,function(){"use strict";function e(e){function l(e){for(var t,n=/\{([\s\S]+?)\}/g,i="";null!==(t=n.exec(e));)i+="|\\{"+t[1]+"\\}";return new RegExp(i.substr(1),"g")}function s(e){for(var n=p(e),i=e.length,r=0;i>r;r++)n[r].offsetWidth?(H.push(t(e[r],n[r],T.lazyload,T.centerImage,B)),S.push(e[r]),W.push(n[r])):C.push(e[r])}function c(e){var t,n,i=e.src.split("?"),r=z,a=T.path;return e.path=i[0],-1!==T.blacklist.indexOf(e.ext)?e.path:(e.ext in I&&(r=I[e.ext],a=T.pathOverride[e.ext]),t=a.replace(r,function(t,n,i){return f(e,t,n,i)}),i.length>1&&(n=i[1],t+=E?"&"+n:"?"+n),e.path=t,t)}function f(e,t){var n;switch(t){case"{width}":return n=b(T.widths,e.offsetWidth)*(T.dubbleSizeRetina?T.retinaMultiplyer:1),n=~~n,e.width=n,n;case"{height}":return h(e);case"{retina}":return u?1:0;case"{quality}":return T.dubbleSizeRetina?T.retinaQuality:T.normalQuality;default:return n=t.substr(1,t.length-2),n in e?e[n]:""}}function h(e){var t;return"object"==typeof T.heights?t=b(T.heights,e.offsetHeight):"aspectratio"===T.heights&&(t=~~(e.offsetHeight/e.offsetWidth*b(T.widths,e.offsetWidth))),t*=T.dubbleSizeRetina?T.retinaMultiplyer:1,e.height=~~t,t}function d(e){var t,n;return e?(t=e.split(/\?|\#/i)[0],n=t.match(/(?:\.([^.]+))?$/)[1]):!1}function p(e){for(var t,n,i=[],r=e.length,a=0,o={};r>a;a++)if(i[a]={},i[a].offsetWidth=e[a].offsetWidth,i[a].offsetHeight=e[a].offsetHeight,t=e[a].getElementsByTagName("noscript")[0],t&&(o=t.dataset?t.dataset:v(t),"src"in o)){for(n in o)i[a][n]=o[n];i[a].ext=d(i[a].src),i[a].path=c(i[a])}return i}function v(e){var t,n,i,r={},a=0;if("undefined"==typeof e||!("attributes"in e))return r;for(t=e.attributes,n=t.length;n>a;a++)/^data-/.test(t[a].name)&&(i=t[a].name.substr(5).replace(/-(.)/g),r[i]=t[a].value);return r}function g(e){var t=[];return e=e.replace(/[.]/,""),t=o.querySelectorAll?o.querySelectorAll("."+e):m(e)}function m(e){var t,n=[],i=o.getElementsByTagName("*");for(t in i)(" "+i[t].className+" ").indexOf(" "+e+" ")>-1&&n.push(i[t]);return n}function y(){var e=C;C=[],s(e)}function b(e,t){var n,i,r,a,o=0;if(!e)return t;for(n=e.length,a=e[n-1];n>o;o++){if(r=e[o]-t,T.closestAbove){if(0>r)continue}else r=0>r?~r:r;(void 0===i||i>r)&&(i=r,a=e[o])}return a}function w(){var e=0,t=H.length;for(T.reloadOnResize&&a.removeEventListener("resize",L),T.lazyload&&(a.removeEventListener("resize",R),a.removeEventListener("scroll",R));t>e;e++)H[e].destruct();B=null,H=null,S=null,W=null}var E,z,x,L,O,R,T={},N={nodeList:[],className:"rimd",widths:["320","600","1024"],heights:["320","600","1024"],path:"resimage/?image={path}&w={width}",pathOverride:{},blacklist:[],reloadOnResize:!1,lazyload:!1,closestAbove:!1,centerImage:!1,dubbleSizeRetina:!1,retinaMultiplyer:2,retinaQuality:40,normalQuality:80},H=[],S=[],W=[],C=[],B=[],I={};return T=n(N,e),T.dubbleSizeRetina=T.dubbleSizeRetina&&u,E=T.path.split("?").length>1,z=l(T.path),i(T.pathOverride)&&!function(){var e;for(e in T.pathOverride)T.pathOverride.hasOwnProperty(e)&&(I[e]=l(T.pathOverride[e]))}(),x=T.nodeList.length?T.nodeList:g(T.className),s(x),x=null,T.reloadOnResize&&(L=r(function(){for(var e=p(S),t=0,n=S.length;n>t;t++)"src"in e[t]&&W[t].path!==c(e[t])&&H[t].updateImage(e[t]);W=e},200),a.addEventListener("resize",L)),T.lazyload&&(R=r(function(){var e,t,n,i,r,u,l=B.length;if(l){for(e=[],t=o.documentElement,n=t.clientTop||0,i=t.clientHeight||a.innerHeigth,l-=1;l>-1;l--)r=B[l].e.getBoundingClientRect().top,0>r-n-1.5*i&&e.push(B.splice(l,1)[0]);for(l=e.length-1;l>-1;l--)u=e[l],u.i.src=u.s,u.e.appendChild(u.i)}},150),a.addEventListener("scroll",R),a.addEventListener("resize",R)),O={destruct:w,options:T,update:L,addImages:s,updateQueue:y}}function t(e,t,n,i,r){function u(t){t.path&&(c&&c.parentNode&&c.parentNode.removeChild(c),c=o.createElement("img"),f=t.path,t.alt&&(c.alt=t.alt),t.title&&(c.title=t.title),t["class"]&&(c.className=t["class"]),i&&(t.width&&(c.style.left="50%",c.style.marginLeft=-t.width/2+"px"),t.height&&(c.style.top="50%",c.style.marginTop=-t.height/2+"px")),!n||l(e)?(c.src=f,e.appendChild(c)):r.push({e:e,i:c,s:f}))}function l(e){var t=e.getBoundingClientRect().top,n=o.documentElement;return t-(n.clientTop||0)-1.5*(n.clientHeight||a.innerHeigth)<0}function s(){c&&c.parentNode&&c.parentNode.removeChild(c),c=null}var c,f;return u(t),{updateImage:u,destruct:s}}function n(e,t){for(var n in t)t.hasOwnProperty(n)&&"undefined"!=typeof t[n]&&(e[n]=t[n]);return e}function i(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n}function r(e,t,n){var i,r=0,a=null,o=function(){r=(new Date).getTime(),e.apply(n,i),n=i=null};return t=t||17,function(){var e=(new Date).getTime(),u=t-(e-r);i=arguments,n=n||this,r&&(0>=u||u>t)?(a&&(clearTimeout(a),a=null),o()):r?(clearTimeout(a),a=setTimeout(o,u)):o()}}if(!window)return!1;var a=window,o=document,u=a.devicePixelRatio>1;return a.addEventListener||!function(e,t,n,i,r,a,o){e[i]=t[i]=n[i]=function(e,t){var n=this;o.unshift([n,e,t,function(e){e.currentTarget=n,e.preventDefault=function(){e.returnValue=!1},e.stopPropagation=function(){e.cancelBubble=!0},e.target=e.srcElement||n,t.call(n,e)}]),this.attachEvent("on"+e,o[0][3])},e[r]=t[r]=n[r]=function(e,t){var n,i=0;for(i;n==o[i];++i)if(n[0]==this&&n[1]==e&&n[2]==t)return this.detachEvent("on"+e,o.splice(i,1)[0][3])},e[a]=t[a]=n[a]=function(e){return this.fireEvent("on"+e.type,e)}}(Window.prototype,HTMLDocument.prototype,Element.prototype,"addEventListener","removeEventListener","dispatchEvent",[]),e});